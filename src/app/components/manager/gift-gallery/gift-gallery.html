<div class="page-container animate-fade-up" dir="rtl">
    <header class="page-header">
        <div class="title-group">
            <h1 class="page-title">ניהול <span class="highlight">מתנות</span></h1>
            <p class="subtitle">צפייה וניהול קטלוג המתנות והגרלות</p>
        </div>
        <p-button label="הוספת מתנה חדשה" icon="pi pi-plus" (click)="onAdd()" class="cta-gradient-btn"></p-button>
    </header>

    <div class="table-card">
        <p-table [value]="listOfGifts" [rows]="10" [paginator]="true" styleClass="custom-premium-table">
            <ng-template pTemplate="header">
                <tr>
                    <th style="width: 80px">מזהה</th>
                    <th>תמונה</th>
                    <th>שם המתנה</th>
                    <th>מחיר כרטיס</th>
                    <th>קטגוריה</th>
                    <th class="text-center">סטטוס מכירות</th>
                    <th>תורם</th>
                    <th class="text-center">פעולות</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-gift>
                <tr class="table-row">
                    <td><span class="id-badge">#{{gift.id}}</span></td>
                    <td>
                        <div class="img-wrapper">
                            <img
                                [src]="gift.imageUrl?.startsWith('http') ? gift.imageUrl : IMAGE_BASE_URL + gift.imageUrl" />
                        </div>
                    </td>
                    <td class="gift-name-cell">{{gift.name}}</td>
                    <td><span class="price-tag">{{gift.ticketPrice | currency:'ILS'}}</span></td>
                    <td><span class="category-badge">{{gift.categoryName}}</span></td>
                    <td class="text-center">
                        <div class="status-pill">
                            <i class="pi pi-ticket"></i>
                            <span class="count">{{gift.purchasersCount || 0}}</span>
                            <span class="label">נמכרו</span>
                        </div>
                    </td>
                    <td class="donor-name">{{gift.donorName}}</td>
                    <td>
                        <div class="actions-group">
                            <button class="action-btn edit" (click)="onEdit(gift)" pTooltip="עריכה"
                                tooltipPosition="top">
                                <i class="pi pi-pencil"></i>
                            </button>
                            <button class="action-btn lottery" (click)="lottery(gift.id)" pTooltip="בצע הגרלה"
                                tooltipPosition="top">
                                <i class="pi pi-gift"></i>
                            </button>
                            <button class="action-btn delete" (click)="delete(gift.id)" pTooltip="מחיקה"
                                tooltipPosition="top">
                                <i class="pi pi-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>

<p-dialog [header]="selectedGift ? 'עריכת מתנה' : 'הוספת מתנה חדשה'" [(visible)]="displayDialog"
    [style]="{width: '45vw'}" [modal]="true" [draggable]="false" [resizable]="false" styleClass="custom-dialog">
    <app-gift-form [giftToEdit]="selectedGift" [categories]="categories" (save)="onSaveGift($event)"
        (cancel)="closeDialog()">
    </app-gift-form>
</p-dialog>