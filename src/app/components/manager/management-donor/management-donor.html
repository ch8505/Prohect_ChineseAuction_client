<div class="page-container">
    <h1 class="page-title">ניהול <span class="highlight">תורמים</span></h1>

    <div class="controls-container">
        <div class="controls-glass-card">

            <div class="search-section flex gap-3 w-full">
                
                <div class="input-glow-wrapper flex-1">
                    <i class="pi pi-search search-icon"></i>
                    <input type="text" pInputText placeholder="חפש לפי שם..." [(ngModel)]="searchName" (keyup.enter)="performSearch()" class="modern-search" />
                </div>

                <div class="input-glow-wrapper flex-1">
                    <i class="pi pi-envelope search-icon"></i>
                    <input type="text" pInputText placeholder="חפש לפי אימייל..." [(ngModel)]="searchEmail" (keyup.enter)="performSearch()" class="modern-search" />
                </div>
            </div>

            <div class="actions-section">
                <p-button icon="pi pi-search" (click)="performSearch()" label="חפש" [outlined]="true" class="premium-btn search-btn">
                </p-button>

                <p-button icon="pi pi-refresh" (click)="clearSearch()" [text]="true" class="premium-btn reset-btn"
                    pTooltip="נקה סינון" tooltipPosition="bottom">
                </p-button>

                <div class="divider"></div>

                <p-button label="תורם חדש" icon="pi pi-plus" (click)="openNew()" class="premium-btn add-btn">
                </p-button>
            </div>

        </div>
    </div>

    <div class="card mt-4">
        <p-table [value]="listOfDonors" class="p-datatable-striped" [tableStyle]="{'min-width': '50rem'}">
            <ng-template pTemplate="header">
                <tr>
                    <th>קוד</th>
                    <th>שם</th>
                    <th>email</th>
                    <th>phone</th>
                    <th>הוספת מתנה לתורם</th>
                    <th>edit</th>
                    <th>delete</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-donor>
                <tr>
                    <td>{{donor.id}}</td>
                    <td>{{donor.name}}</td>
                    <td>{{donor.email}}</td>
                    <td>{{donor.phone}}</td>
                     <td class="flex gap-2">
                        <p-button icon="pi pi-gift" [text]="true" (click)="onEdit(donor)">הוסף מתנה</p-button>
                    </td>
                    <td class="flex gap-2">
                        <p-button icon="pi pi-pencil" [text]="true" (click)="onEdit(donor)">עדכון</p-button>
                    </td>
                    <td>
                          <p-button icon="pi pi-trash" [text]="true" severity="danger" (click)="delete(donor.id)">מחק</p-button>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>

</div>

<p-table [value]="listOfDonors" class="p-datatable-striped">
    <ng-template pTemplate="header">
        <tr>
            <th>קוד</th>
            <th>שם</th>
            <th>email</th>
            <th>phone</th>
            <th>הוספת מתנה לתורם</th>
            <th>edit</th>
            <th>delete</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-donor>
        <tr>
            <td>{{donor.id}}</td>
            <td>{{donor.name}}</td>
            <td>{{donor.email}}</td>
            <td>{{donor.phone}}</td>
            <td class="flex gap-2">
                <p-button icon="pi pi-plus" [text]="true" (click)="openGiftDialog(donor)">הוסף מתנה</p-button>
            </td>
            <td class="flex gap-2">
                <p-button icon="pi pi-pencil" [text]="true" (click)="onEdit(donor)">עדכון</p-button>
            </td>
            <td>
                <p-button icon="pi pi-trash" [text]="true" severity="danger" (click)="delete(donor.id)">מחק</p-button>
            </td>
        </tr>
    </ng-template>
</p-table>

@if(displayDialog) {
<p-dialog [header]="selectedDonor ? 'עריכת תורם' : 'הוספת תורם'" [(visible)]="displayDialog" [modal]="true"
    [style]="{ width: '400px' }">
    <app-donor-form [donorToEdit]="selectedDonor" (save)="saveDonor($event)" (cancel)="displayDialog = false">
    </app-donor-form>
</p-dialog>
}

@if(displayGiftDialog) {
<p-dialog header="הוספת מתנה לתורם" [(visible)]="displayGiftDialog" [modal]="true">
    <app-gift-form [categories]="categories" (save)="addGiftToDonor($event)" (cancel)="displayGiftDialog = false">
    </app-gift-form>
</p-dialog>
}